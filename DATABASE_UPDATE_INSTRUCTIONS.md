# Database Update Instructions

To fix the errors and restore full functionality to the chat application, you need to manually create the missing database tables and columns in your Supabase dashboard.

## Step 1: Add Role Column to Profiles Table

Run this SQL command in your Supabase SQL Editor:

```sql
ALTER TABLE profiles ADD COLUMN IF NOT EXISTS role TEXT DEFAULT 'user';
```

## Step 2: Create Room Members Table

Run this SQL command in your Supabase SQL Editor:

```sql
CREATE TABLE IF NOT EXISTS room_members (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  room_id BIGINT REFERENCES rooms NOT NULL,
  user_id UUID REFERENCES auth.users NOT NULL,
  joined_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::TEXT, NOW()) NOT NULL,
  UNIQUE(room_id, user_id)
);
```

## Step 3: Add Row Level Security (RLS) to Room Members Table

Run these SQL commands in your Supabase SQL Editor:

```sql
-- Set up Row Level Security (RLS)
ALTER TABLE room_members ENABLE ROW LEVEL SECURITY;

-- Create policies
CREATE POLICY "Room members are viewable by everyone." ON room_members
  FOR SELECT USING (true);
  
CREATE POLICY "Authenticated users can join rooms." ON room_members
  FOR INSERT WITH CHECK (auth.role() = 'authenticated');
  
CREATE POLICY "Users can leave rooms they joined." ON room_members
  FOR DELETE USING (auth.uid() = user_id);
```

## Step 4: Set Admin User (Optional)

If you want to set a specific user as an admin, run this command (replace 'USER_ID' with the actual user ID):

```sql
UPDATE profiles SET role = 'admin' WHERE id = 'USER_ID';
```

## After Running These Commands

1. Restart your development server:
   ```bash
   npm run dev
   ```

2. The errors should be resolved and all chat functionality should work properly with smooth animations.

3. The presence tracking, room membership, and admin features will now function correctly.