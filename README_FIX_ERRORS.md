# How to Fix the Chat Application Errors

The errors you're seeing are due to missing database tables and columns. Here's how to fix them properly while maintaining all core functionality:

## Problem Summary

The application is trying to access:
1. A `role` column in the `profiles` table (for admin functionality)
2. A `room_members` table (for tracking which users are in which rooms)

These database elements are missing, causing the console errors.

## Solution

### Step 1: Create the Missing Database Tables

You need to manually create these tables in your Supabase dashboard:

1. Go to your Supabase project dashboard
2. Open the **SQL Editor**
3. Run the following SQL commands one by one:

#### Add Role Column to Profiles Table
```sql
ALTER TABLE profiles ADD COLUMN IF NOT EXISTS role TEXT DEFAULT 'user';
```

#### Create Room Members Table
```sql
CREATE TABLE IF NOT EXISTS room_members (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  room_id BIGINT REFERENCES rooms NOT NULL,
  user_id UUID REFERENCES auth.users NOT NULL,
  joined_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::TEXT, NOW()) NOT NULL,
  UNIQUE(room_id, user_id)
);
```

#### Add Row Level Security (RLS) to Room Members Table
```sql
-- Set up Row Level Security (RLS)
ALTER TABLE room_members ENABLE ROW LEVEL SECURITY;

-- Create policies
CREATE POLICY "Room members are viewable by everyone." ON room_members
  FOR SELECT USING (true);
  
CREATE POLICY "Authenticated users can join rooms." ON room_members
  FOR INSERT WITH CHECK (auth.role() = 'authenticated');
  
CREATE POLICY "Users can leave rooms they joined." ON room_members
  FOR DELETE USING (auth.uid() = user_id);
```

### Step 2: Set an Admin User (Optional)

To have admin capabilities, update a user's role:
```sql
UPDATE profiles SET role = 'admin' WHERE id = 'USER_ID';
```
Replace 'USER_ID' with the actual user ID from your Supabase auth users table.

### Step 3: Restart Your Application

After creating the tables:
```bash
# Stop the current server (Ctrl+C)
# Then start it again
npm run dev
```

## What This Fixes

1. **Presence Tracking**: Users will properly show as online/offline in rooms
2. **Room Membership**: Users will only see rooms they've joined
3. **Admin Functionality**: Admin users can delete rooms and messages
4. **Smooth Animations**: All GSAP animations will work properly
5. **Real-time Updates**: Messages will appear instantly for all users in the room

## Maintained Features

- All real-time messaging functionality
- Smooth GSAP animations for messages and transitions
- Presence indicators (online/offline)
- Typing indicators
- Admin controls for room/message management
- Emoji picker
- Markdown support in messages
- Responsive design for all screen sizes

The errors will disappear once the database schema is complete, and all chat functionality will work as intended with smooth animations.