# Supabase Setup Guide

This guide explains how to set up Supabase for the Chat App.

## Prerequisites

1. A Supabase account (free tier available at [supabase.com](https://supabase.com/))
2. A Supabase project created

## Setting Up Environment Variables

Create a `.env.local` file in the root of your project with the following variables:

```env
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key
```

### Where to Find Your Supabase Credentials

1. **Project URL and Anon Key**:
   - Go to the [Supabase Dashboard](https://supabase.com/dashboard)
   - Select your project
   - Click on the "Project Settings" gear icon in the left sidebar
   - Click on "API" in the settings menu
   - Under "Project API keys", you'll find:
     - **Project URL**: This is your `NEXT_PUBLIC_SUPABASE_URL`
     - **anon key**: This is your `NEXT_PUBLIC_SUPABASE_ANON_KEY`

2. **Service Role Key**:
   - In the same "API" settings page
   - Scroll down to find the "service_role key"
   - This is your `SUPABASE_SERVICE_ROLE_KEY`
   - ⚠️ **Important**: Keep this key secret and never expose it in client-side code!

## Database Schema

The application expects the following tables:

1. **profiles** table:
   ```sql
   create table profiles (
     id uuid references auth.users not null primary key,
     updated_at timestamp with time zone,
     username text unique,
     full_name text,
     avatar_url text,
     website text,
     constraint username_length check (char_length(username) >= 3)
   );
   ```

2. **rooms** table:
   ```sql
   create table rooms (
     id bigint generated by default as identity primary key,
     created_at timestamp with time zone default timezone('utc'::text, now()) not null,
     name text not null
   );
   ```

3. **messages** table:
   ```sql
   create table messages (
     id bigint generated by default as identity primary key,
     created_at timestamp with time zone default timezone('utc'::text, now()) not null,
     room_id bigint references rooms not null,
     user_id uuid references auth.users not null,
     content text not null
   );
   ```

## Row Level Security (RLS) Policies

To ensure data security, enable Row Level Security on the tables and add these policies:

1. **Profiles policies**:
   ```sql
   alter table profiles enable row level security;
   
   create policy "Public profiles are viewable by everyone."
     on profiles for select
     using ( true );
     
   create policy "Users can insert their own profile."
     on profiles for insert
     with check ( auth.uid() = id );
     
   create policy "Users can update own profile."
     on profiles for update
     using ( auth.uid() = id );
   ```

2. **Rooms policies**:
   ```sql
   alter table rooms enable row level security;
   
   create policy "Rooms are viewable by everyone."
     on rooms for select
     using ( true );
   ```

3. **Messages policies**:
   ```sql
   alter table messages enable row level security;
   
   create policy "Messages are viewable by everyone."
     on messages for select
     using ( true );
     
   create policy "Authenticated users can insert messages."
     on messages for insert
     with check ( auth.role() = 'authenticated' );
   ```

## Seeding Initial Rooms

To add initial rooms to your database, you can use the seeding script:

1. Run the seeding script via terminal:
   ```bash
   npm run seed
   ```

2. Or visit the room initialization page at `/seed-rooms` in your browser

This will create 5 initial rooms:
- Welcome Lounge
- Creative Brainstorming
- Tech Talk
- Design Studio
- Random Chit Chat

## Troubleshooting

If you encounter any issues:

1. Double-check that all environment variables are correctly set in `.env.local`
2. Ensure that the Supabase project URL doesn't end with a trailing slash
3. Verify that you're using the correct API keys from the Supabase dashboard
4. Confirm that all database tables exist with the correct schema
5. Check that Row Level Security policies are properly configured